---
layout: page
permalink: /pirate.html
redirect_from:
  - /assets/pirate.html

hidden: true
no_menu: true
title: Pirate Playground

header_content:
  script: >
    window.pirate.yellow();

  style: >
    #demo fieldset {
      border: 1px dashed red;
    }

    #demo fieldset input[type=text] {
      font-size: 1rem;
      border-width: 0;
      border-style: none;
      border-bottom: 1px dotted red;
    }

body_data:
  environment: testkit

---

Augments standard Google Tag Manager but adding *data context* to each event,
based on the event's placement in the document.

## Usage

This page shows example structure for defining `data-` attributes.

*Requirements:*

1. The content of <a href='/js/pirate.js'>`pirate.js`</a> must be loaded <em>after</em> Google Tag Manager. Including it as a custom Javascript within GTM is sufficient.
2. Data attributes (`data-` prefix) must be added to elements of interest in the page.
3. Click triggers and (most importantly) built-in variables `Click Element` and `Form Element` must be activiated in Tag Manager.
4. Variables within Tag Manager must be configured to access related properties within the datalayer.
5. Triggers within Google Tag Manager must be configured with conditions related to those data attributes.


## Example


Given the page structure:


```html
<div data-context='product'>
  <ul data-product-category='loot'>
    <li data-product-action='click'>
      <a href='/product/loot/12345'>View Details</a>
    </li>
  </ul>
</div>
```


A click on the link will produce the following event in GTM's DataLayer:

```javascript
window.dataLayer.push({
  'event': 'gtm.click',
  'gtm.element': (linkElementClicked),
  'pirate': { // all inherited attributes reside here
    'productAction': 'click',
    'productCategory': 'loot',
    'context': 'product'
  }
});
```


The kit intercepts all events to Google Tag Manager, and when `gtm.element` is provided, collects data attributes (inherited from parent elements) as properties on the event object, for use in Google Tag Manager variables.


Note that the inherited properties are provided in the `pirate` sub-object
within each `dataLayer.push`; this ensures that the properties of that element
do not persist into subsequent events.

To enable persistent properties, see the `pirate.moor` function below.


The kit also adds new event types for fine-grained interaction observers:


* `focus` and `blur` events on the main window, as well as form fields.
* `scroll` events on the main window.
* `touchstart` and `mousedown` for when `click` is too late.
* ... and several others.

If needed, additional event types can be added to the listening environment:

```javascript
window.pirate.config.EVENTS.BODY.push('mouseup');
```


## Utility methods

This framework also provides a global interface `pirate`.

```javascript
/** Enable debug logging to console */
window.pirate.yellow();


/** Register a handler method for DOM event listening, filtered by Regular Expression
 * param {RegExp} filterExpressionOptional default null
 * param {function(this: DOMElement, DOMEvent)} eventHandlerMethod
 */
window.pirate.gangway(
  /eventNameExpr/i,
  function(/* DOMEvent */ event){
    // this: the DOM element producing the event
    // ... do something with the element + event.
  });


/** Retrieve the inherited data context of a specific element.
 * Converts hyphenated names to camel case, e.g. "data-test-value" => "testValue"
 * param {DOMElement} element
 * return {Object}
 */
window.pirate.pillage(element); // => Object

/** Retrieve the inherited data context from one or more elements matching a CSS selector.
 * Like `pillage` above, but evaluates the CSS selector, then pillages each matching element.
 * param {String} cssSelectorExpression
 * return {Array.<Object>}
 */
window.pirate.hornswaggle('li a.download'); // => [Object, Object...]


/** Persist the properties of a particular element to the DataLayer
 * param {String} cssSelectorExpression
 */
window.pirate.moor('body.post article[data-author] section');

```

## Test Area

<div id='demo'>
<fieldset>
<legend>Demo zone</legend>
<div class='column left col-1-2'>
<input type='text' value='Test area.'/>
</div>
<div class='column col-1-2' data-subject-area='lists'>
<a class='link' data-interaction='navigation' href="javascript:void(0)">Link</a>
</div>
</fieldset>
</div>
