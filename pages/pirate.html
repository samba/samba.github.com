---
layout: page
permalink: /pirate.html
redirect_from:
  - /assets/pirate.html

hidden: true
no_menu: true
title: Pirate Playground
tweet_bottom: false
dont_tweet: true
header_content:
  script: >
    window.dataLayer.push({
      'event': 'pirate.config',
      'pirate.logLevel': 'debug'
    })

    window.pirate.ondeck(function(){
      window.pirate.attach('submit', 'form.donothing', function(e){
        // e.stopPropagation();
        e.preventDefault();
        return false;
      });
    });

  style: >
    #demo fieldset {
      border: 1px dashed red;
    }

    #demo fieldset input[type=text] {
      font-size: 1rem;
      border-width: 0;
      border-style: none;
      border-bottom: 1px dotted red;
    }

    #demo fieldset label.left {
      float: left;
      clear: both;
    }

    #demo fieldset select.test[multiple] {
      font-size: 1rem;
      border: 1px dotted red;
      display: inline-block;
      float: left;
      clear: left;
    }

    #demo input[type=submit], #demo button {
      border: 1px black dashed;
      border-width: 0 0 1px 0;
      background-color: rgba(0, 0, 0, 0.2)
    }

body_data:
  environment: testkit

---

Augments standard Google Tag Manager but adding *data context* to each event,
based on the event's placement in the document.

## Usage

This page shows example structure for defining `data-` attributes.

*Requirements:*

1. The content of <a href='/js/pirate.js'>`pirate.js`</a> must be loaded <em>after</em> Google Tag Manager. Including it as a custom Javascript within GTM is sufficient.
2. Data attributes (`data-` prefix) must be added to elements of interest in the page.
3. Click triggers and (most importantly) built-in variables `Click Element` and `Form Element` must be activiated in Tag Manager.
4. Variables within Tag Manager must be configured to access related properties within the datalayer.
5. Triggers within Google Tag Manager must be configured with conditions related to those data attributes.


## Example


Given the page structure:


```html
<div data-context='product'>
  <ul data-product-category='loot'>
    <li data-product-action='click'>
      <a href='/product/loot/12345'>View Details</a>
    </li>
  </ul>
</div>
```


A click on the link will produce the following event in GTM's DataLayer:

```javascript
window.dataLayer.push({
  'event': 'gtm.click',
  'gtm.element': (linkElementClicked),
  'pirate': { // all inherited attributes reside here
    'productAction': 'click',
    'productCategory': 'loot',
    'context': 'product'
  }
});
```


The kit intercepts all events to Google Tag Manager, and when `gtm.element` is provided, collects data attributes (inherited from parent elements) as properties on the event object, for use in Google Tag Manager variables.


Note that the inherited properties are provided in the `pirate` sub-object
within each `dataLayer.push`; this ensures that the properties of that element
do not persist into subsequent events.

To enable persistent properties, see the `pirate.moor` function below.


The kit also adds new event types for fine-grained interaction observers:

* `focus` and `blur` events on the main window, as well as form fields.
* `scroll` events on the main window.
* `touchstart` and `mousedown` for when `click` is too late.
* ... and several others.

If needed, additional event types can be added to the listening environment:

```javascript
window.pirate.observe('mouseup', 'contextmenu');
```

And if there's an event you decide you don't care for:

```javascript
window.pirate.mute('mouseup');
```

These event configurations can also be stashed in the DataLayer before (or after)
Pirate loads:

```javascript
dataLayer.push({
  'event': 'pirate.config',
  'pirate.eventsMute': '*', // mute all, or a space-separated list
  'pirate.eventsObserve': "mouseup mousedown" // or '*' to unmute all muted
})
```


> Some colleagues have indicated that the volume of events produced by Pirate
> seems excessive. The standard event configuration aims to "observe" the most
> common interactions that many sites require, however most sites will not use
> all or even most of the general set. GTM will basically ignore any events that
> Pirate produces until triggers are configured to read from them, and there
> should be no significant performance impact.


## Utility methods

This framework also provides a global interface `pirate`.

```javascript
/** Enable debug logging to console */
window.pirate.yellow('debug');


/** Retrieve the inherited data context of a specific element.
 * Converts hyphenated names to camel case, e.g. "data-test-value" => "testValue"
 * param {DOMElement} element
 * return {Object}
 */
window.pirate.pillage(element); // => Object

/** Retrieve the inherited data context from one or more elements matching a CSS selector.
 * Like `pillage` above, but evaluates the CSS selector, then pillages each matching element.
 * param {String} cssSelectorExpression
 * return {Array.<Object>}
 */
window.pirate.hornswaggle('li a.download'); // => [Object, Object...]


/** Persist the properties of a particular element to the DataLayer
 * param {String} cssSelectorExpression
 */
window.pirate.moor('body.post article[data-author] section');

// Pirate also provides some sensible DOM abstractions:
window.pirate.ondeck(function(){  // runs when the DOM is completely ready.
  // Attach an event listener to matching elements.
  window.pirate.attach("click", "li.awesome-links", function(e){
    // Maybe you should push a business-semantic event here?
    // This would be a good place to hornswaggle properties from other parts of
    // the page, so they can be presented in more relevant DataLayer events.
    // Drop a block like this in a Custom HTML tag, and you can quickly add
    // significant context to your trickier interactions.
  })
});



```

## Test Area

<div id='demo'>
<form action='/test' class='donothing' name='toast' target='_blank'>
<fieldset>
<legend>Demo zone</legend>
<div class='column left col-1-2'>
  <input type='text' name='atextfield' value='Test area.'/>
</div>
<div class='column col-1-2' data-subject-area='lists'>
  <a class='link' data-interaction='navigation' href="javascript:void(0)">Link</a>
</div>

<div class='column left col-1-2'>
  <label for='blarg' class='left'>Test select field.</label>
  <select class='test' name='blarg' multiple>
    <option value='one'>One</option>
    <option value='two'>Two</option>
    <option value='three'>Three</option>
  </select>
</div>

<div class='column left col-1-2'>

  <input type='checkbox' id='color-white' value='white' name='color'/>
  <label for="color-white">White.</label>

  <input type='checkbox' id='color-red' value='red' name='color'/>
  <label for="color-red" >Red.</label>

  <input type='checkbox' id='color-green' value='green' name='color'/>
  <label for="color-green" >Green.</label>

</div>


<!-- <button type='submit' form='toast'>Submit, too</button> -->
<input type='submit' value='Submit!'/>
</fieldset>
</form>
</div>

